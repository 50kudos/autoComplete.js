var a,b;a=this,b=function(){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function u(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw r}}}}function l(e,t){for(var i=document.getElementsByClassName("autoComplete_list"),n=0;n<i.length;n++)e!==i[n]&&e!==t&&i[n].parentNode.removeChild(i[n])}function c(o,l,u){for(var e,t,i,c=(e=l.inputField,t=l,(i=document.createElement("div")).setAttribute("id",t.listId),i.setAttribute("aria-expanded",!0),i.setAttribute("aria-labelledby",t.listId),i.setAttribute("class",t.listClass),i.setAttribute("role","listbox"),i.setAttribute("tabindex","-1"),t.container&&container(i),e.parentNode.appendChild(i),i),n=function(t){var e,i,n,r,a,s=o[t].match,s=(e=s,i=o[t].value,n=t,r=l.itemClass,a=l.itemContent,(s=document.createElement("div")).setAttribute("id","".concat(r,"_").concat(n)),s.setAttribute("aria-selected","false"),s.setAttribute("class",r),s.setAttribute("role","option"),s.innerHTML=e,a&&a(i,s),s);s.addEventListener("click",function(){var e={input:l.rawInputValue,query:l.queryInputValue,results:o,selection:o[t].value};u(e)}),c.appendChild(s)},r=0;r<o.length;r++)n(r);return c}function d(e,t,i){e.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:t,cancelable:!0}))}function i(e){e&&(function(e){for(var t=0;t<e.length;t++)e[t].setAttribute("aria-selected","false"),e[t].classList.remove("autoComplete_selected")}(e),p>=e.length&&(p=0),p<0&&(p=e.length-1),e[p].setAttribute("aria-selected","true"),e[p].classList.add("autoComplete_selected"))}function h(e){var t=(t=document.getElementById("autoComplete_list"))&&t.getElementsByTagName("div");27===e.keyCode?l(!1,e.target):40===e.keyCode||9===e.keyCode?(e.preventDefault(),p++,i(t)):38===e.keyCode||9===e.keyCode?(e.preventDefault(),p--,i(t)):13===e.keyCode&&(e.preventDefault(),-1<p&&t&&t[p].click()),d(e.srcElement,{selection:t[p],event:e},"navigation")}function f(a,s,o){for(var l=[],e=function(i){function e(e){var t=e?n[e]:n;t&&((t="function"==typeof o.searchEngine?o.searchEngine(a,t):function(e,t,i){var n=t.toLowerCase();if("loose"===i.searchEngine){e=e.replace(/ /g,"");for(var r=[],a=0,s=0;s<n.length;s++){var o=t[s];a<e.length&&n[s]===e[a]&&(o=i.highlight?'<span class="autoComplete_highlighted">'.concat(o,"</span>"):o,a++),r.push(o)}if(a===e.length)return r.join("")}else if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),i.highlight?t.replace(e,'<span class="autoComplete_highlighted">'.concat(e,"</span>")):t}(a,t,o))&&e?l.push({key:e,index:i,match:t,value:n}):t&&!e&&l.push({index:i,match:t,value:n}))}var n=s[i];if(o.key){var t,r=u(o.key);try{for(r.s();!(t=r.n()).done;)e(t.value)}catch(e){r.e(e)}finally{r.f()}}else e()},t=0;t<s.length;t++)e(t);return(o.sort?l.sort(o.sort):l).slice(0,o.maxResults)}function a(i,n){var r;return function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){return i.apply(e,t)},n)}}var p;return function(){function q(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q);var t=e.name,i=void 0===t?"Search":t,n=e.selector,r=void 0===n?"#autoComplete":n,a=e.data,s=a.src,o=a.key,l=a.cache,u=void 0===l||l,c=e.query,d=e.trigger,h=(d=void 0===d?{}:d).event,f=void 0===h?["input"]:h,p=d.condition,m=void 0!==p&&p,v=e.searchEngine,b=void 0===v?"strict":v,y=e.threshold,g=void 0===y?0:y,C=e.debounce,A=void 0===C?0:C,k=e.resultsList,E=(k=void 0===k?{}:k).render,I=void 0===E||E,L=k.container,N=void 0!==L&&L,x=k.destination,w=k.position,F=void 0===w?"afterend":w,t=k.element,n=void 0===t?"ul":t,a=k.idName,l=void 0===a?"autoComplete_list":a,h=k.className,d=void 0===h?"autoComplete_list":h,p=k.navigation,v=void 0!==p&&p,y=e.sort,C=void 0!==y&&y,E=e.placeHolder,L=e.maxResults,w=void 0===L?5:L,t=e.resultItem,a=(t=void 0===t?{}:t).content,h=void 0!==a&&a,k=t.element,p=void 0===k?"li":k,y=t.idName,L=void 0===y?"autoComplete_result":y,a=t.className,k=void 0===a?"autoComplete_result":a,y=e.noResults,t=e.highlight,a=void 0!==t&&t,t=e.feedback,e=e.onSelection;this.name=i,this.selector=r,this.data={src:function(){return"function"==typeof s?s():s},key:o,cache:u},this.query=c,this.trigger={event:f,condition:m},this.searchEngine=b,this.threshold=g,this.debounce=A,this.resultsList={render:I,container:N,destination:x||this.inputField,position:F,element:n,idName:l,className:d,navigation:v},this.sort=C,this.placeHolder=E,this.maxResults=w,this.resultItem={content:h,element:p,idName:L,className:k},this.noResults=y,this.highlight=a,this.feedback=t,this.onSelection=e,this.preInit(),this.inputField}var e,t,i;return e=q,(t=[{key:"run",value:function(e,t,i){l(!1,t);var n,r,a=((n=t)instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n.value:n.innerHTML).toLowerCase(),s=(r=a,(o=this.query)&&o.manipulate?o.manipulate(r):r);if(n=this.trigger,o=s,r=this.threshold,n.condition?n.condition(o):o.length>=r&&o.replace(/ /g,"").length){var o={searchEngine:this.searchEngine,highlight:this.highlight,key:this.data.key,sort:this.sort,maxResults:this.maxResults},o=f(s,i,o);if(d(t,{input:a,query:s,results:o},"response"),!i.length)return this.noResults();i={input:a,query:s,results:o};if(!this.resultsList.render)return this.feedback(e,i);i={inputField:t,rawInputValue:a,queryInputValue:s,listId:this.resultsList.idName,listClass:this.resultsList.className,itemId:this.resultItem.idName,itemClass:this.resultItem.className,listContainer:this.resultsList.container,itemContent:this.resultItem.content},o.length&&c(o,i,this.onSelection);d(t,{input:a,query:s,results:o},"rendered"),function(e,t){p=-1;var i=t||h;e.addEventListener("keydown",i)}(t,this.resultsList.navigation),document.addEventListener("click",function(e){return l(e.target,t)})}}},{key:"init",value:function(){var r=this;return new Promise(function(e,n){var t;return r.data.cache?r.data.src().then(function(e){try{return t=e,d(r.inputField,t,"request"),r.placeHolder&&r.inputField.setAttribute("placeholder",r.placeHolder),r.exec=a(function(e){r.run(e,r.inputField,t)},r.debounce),i.call(r)}catch(e){return n(e)}},n):(r.placeHolder&&r.inputField.setAttribute("placeholder",r.placeHolder),r.exec=a(function(t){var i;return r.data.src().then(function(e){try{i=e,d(r.inputField,i,"request"),r.run(t,r.inputField,i)}catch(e){return n(e)}},n)},r.debounce),i.call(r));function i(){return this.inputField.addEventListener("input",this.exec),d(this.inputField,null,"init"),e()}})}},{key:"preInit",value:function(){var s=this,o=document;new MutationObserver(function(e,t){var i,n=u(e);try{for(n.s();!(i=n.n()).done;){var r,a=i.value;o.querySelector(s.selector)&&(t.disconnect(),s.inputField=o.querySelector(s.selector),r={inputName:s.name,listId:s.resultsList.idName,listClass:s.resultsList.className,itemId:s.resultItem.idName,itemClass:s.resultItem.className},i=s.inputField,r=r,i.setAttribute("dir","ltr"),i.setAttribute("type","text"),i.setAttribute("spellcheck",!1),i.setAttribute("autocorrect","off"),i.setAttribute("autocomplete","off"),i.setAttribute("autocapitalize","off"),i.setAttribute("title",r.inputName),i.setAttribute("role","combobox"),i.setAttribute("aria-label",r.inputName),i.setAttribute("aria-owns",r.listId),i.setAttribute("aria-haspopup",!0),i.setAttribute("aria-autocomplete","both"),d(s.inputField,{mutation:a},"connect"),s.init())}}catch(e){n.e(e)}finally{n.f()}}).observe(o,{childList:!0,subtree:!0})}},{key:"attach",value:function(){this.init()}},{key:"detach",value:function(){this.inputField.removeEventListener("input",this.exec),d(this.inputField,null,"detached")}}])&&n(e.prototype,t),i&&n(e,i),q}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"!=typeof globalThis?globalThis:a||self).autoCompleteJS=b();
