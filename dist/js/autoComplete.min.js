var a,b;a=this,b=function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function W(e){return"string"==typeof e?document.querySelector(e):e()}function l(e){return"<span class=".concat(t,">").concat(e,"</span>")}function a(e){return e.innerHTML=""}function d(t,e,n,i,r,o){i({event:t,query:e instanceof HTMLInputElement?e.value:e.innerHTML,matches:r.matches,results:r.list.map(function(e){return e.value}),selection:r.list.find(function(e){return t.keyCode===m?e.index===Number(o.getAttribute(h)):"mousedown"===t.type?e.index===Number(t.currentTarget.getAttribute(h)):void 0})}),a(n)}function c(t,n,i,r){function o(e){c.classList.remove(v),s=1===e?c.nextSibling:c.previousSibling}function a(e){(c=e).classList.add(v)}var s,u=n.childNodes,l=u.length-1,c=void 0;t.onkeydown=function(e){if(0<u.length)switch(e.keyCode){case p:e.preventDefault(),c?(o(0),a(s||u[l])):a(u[l]);break;case g:c?(o(1),a(s||u[0])):a(u[0]);break;case m:c&&d(e,t,n,i,r,c)}},u.forEach(function(e){e.onmousedown=function(e){return d(e,t,n,i,r)}})}var h="data-id",X="autoComplete_list",f="autoComplete_result",t="autoComplete_highlighted",v="autoComplete_selected",m=13,p=38,g=40;return function(){function Q(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Q);var t,n,i=e.selector,r=void 0===i?"#autoComplete":i,o=e.data,a=o.key,s=o.src,u=o.cache,l=void 0===u||u,c=e.query,d=e.trigger,h=(d=void 0===d?{}:d).event,f=void 0===h?["input"]:h,v=d.condition,m=void 0!==v&&v,p=e.searchEngine,g=void 0===p?"strict":p,y=e.threshold,b=void 0===y?0:y,w=e.debounce,E=void 0===w?0:w,L=e.resultsList,S=(L=void 0===L?{}:L).render,C=void 0!==S&&S,x=L.container,k=void 0!==x&&x,A=L.destination,T=L.position,R=void 0===T?"afterend":T,q=L.element,H=void 0===q?"ul":q,M=L.navigation,I=void 0!==M&&M,j=e.sort,P=void 0!==j&&j,_=e.placeHolder,N=e.maxResults,O=void 0===N?5:N,V=e.resultItem,D=(V=void 0===V?{}:V).content,F=void 0!==D&&D,U=V.element,$=void 0===U?"li":U,z=e.noResults,B=e.highlight,G=void 0!==B&&B,J=e.onSelection,K=C?(t={container:k,destination:A||W(r),position:R,element:H},(n=document.createElement(t.element)).setAttribute("id",X),t.container&&t.container(n),t.destination.insertAdjacentElement(t.position,n),n):null;this.selector=r,this.data={src:function(){return"function"==typeof s?s():s},key:a,cache:l},this.query=c,this.trigger={event:f,condition:m},this.searchEngine="loose"===g?"loose":"function"==typeof g?g:"strict",this.threshold=b,this.debounce=E,this.resultsList={render:C,view:K,navigation:I},this.sort=P,this.placeHolder=_,this.maxResults=O,this.resultItem={content:F,element:$},this.noResults=z,this.highlight=G,this.onSelection=J,this.init()}var e,t,n;return e=Q,(t=[{key:"search",value:function(e,t){var n=t.toLowerCase();if("loose"===this.searchEngine){e=e.replace(/ /g,"");for(var i=[],r=0,o=0;o<n.length;o++){var a=t[o];r<e.length&&n[o]===e[r]&&(a=this.highlight?l(a):a,r++),i.push(a)}return r!==e.length?!1:i.join("")}if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),this.highlight?t.replace(e,l(e)):t}},{key:"listMatchedResults",value:function(n){var a=this;return new Promise(function(e){var o=[];n.filter(function(i,r){function e(e){var t=e?i[e]:i;if(t){var n="function"==typeof a.searchEngine?a.searchEngine(a.queryValue,t):a.search(a.queryValue,t);n&&e?o.push({key:e,index:r,match:n,value:i}):n&&!e&&o.push({index:r,match:n,value:i})}}if(a.data.key){var t,n=s(a.data.key);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}else e()});var t=a.sort?o.sort(a.sort).slice(0,a.maxResults):o.slice(0,a.maxResults);return e({matches:o.length,list:t})})}},{key:"ignite",value:function(){var u=this,l=W(this.selector);this.placeHolder&&l.setAttribute("placeholder",this.placeHolder);function o(n){function i(e,t){l.dispatchEvent(new CustomEvent("autoComplete",{bubbles:!0,detail:{event:e,input:r,query:o,matches:t?t.matches:null,results:t?t.list:null},cancelable:!0}))}var r=l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?l.value.toLowerCase():l.innerHTML.toLowerCase(),o=u.queryValue=u.query&&u.query.manipulate?u.query.manipulate(r):r,e=u.resultsList.render,t=u.trigger.condition?u.trigger.condition(o):o.length>=u.threshold&&o.replace(/ /g,"").length;if(e){var s=u.resultsList.view;a(s);t?u.listMatchedResults(u.dataStream,n).then(function(e){var t,r,o,a;i(n,e),u.resultsList.render&&(0===e.list.length&&u.noResults?u.noResults():(t=s,r=e.list,o=u.resultItem,a=document.createDocumentFragment(),r.forEach(function(e,t){var n=document.createElement(o.element),i=r[t].index;n.setAttribute(h,i),n.setAttribute("class",f),o.content?o.content(e,n):n.innerHTML=e.match||e,a.appendChild(n)}),t.appendChild(a),u.onSelection&&(u.resultsList.navigation?u.resultsList.navigation(n,l,s,u.onSelection,e):c(l,s,u.onSelection,e))))}):i(n)}else!e&&t&&u.listMatchedResults(u.dataStream,n).then(function(e){i(n,e)})}this.trigger.event.forEach(function(e){var n,i,r;l.addEventListener(e,(n=function(e){return t=e,void Promise.resolve(u.data.cache?u.dataStream:u.data.src()).then(function(e){u.dataStream=e,o(t)});var t},i=u.debounce,function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){return n.apply(e,t)},i)}))})}},{key:"init",value:function(){var t=this;this.data.cache?Promise.resolve(this.data.src()).then(function(e){t.dataStream=e,t.ignite()}):this.ignite()}}])&&i(e.prototype,t),n&&i(e,n),Q}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
