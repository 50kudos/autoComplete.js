var e,t;e=this,t=function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function i(e){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?n(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw s}}}}var s=function(e,t){for(var n=document.getElementsByClassName(e.resultsList.className),i=0;i<n.length;i++)t!==n[i]&&t!==e.inputField&&n[i].parentNode.removeChild(n[i]);e.inputField.removeAttribute("aria-activedescendant"),e.inputField.setAttribute("aria-expanded",!1)},a=function(e,t,n){var r=function(e){var t=document.createElement(e.resultsList.element);return t.setAttribute("id",e.resultsList.idName),t.setAttribute("aria-label",e.name),t.setAttribute("class",e.resultsList.className),t.setAttribute("role","listbox"),t.setAttribute("tabindex","-1"),e.resultsList.container&&e.resultsList.container(t),("string"==typeof e.resultsList.destination?document.querySelector(e.resultsList.destination):e.resultsList.destination()).insertAdjacentElement(e.resultsList.position,t),t}(e);e.inputField.setAttribute("aria-expanded",!0);for(var o=function(o){var s=t.results[o],a=function(e,t,n){var i=document.createElement(n.resultItem.element);return i.setAttribute("id","".concat(n.resultItem.idName,"_").concat(t)),i.setAttribute("class",n.resultItem.className),i.setAttribute("role","option"),i.innerHTML=e.match,n.resultItem.content&&n.resultItem.content(e,i),i}(s,o,e);a.addEventListener("click",(function(r){var a={event:r,matches:n,input:t.input,query:t.query,results:t.results,selection:i(i({},s),{},{index:o})};e.onSelection&&e.onSelection(a)})),r.appendChild(a)},s=0;s<t.results.length;s++)o(s);return r},l=function(e,t,n){e.dispatchEvent(new CustomEvent(n,{bubbles:!0,detail:t,cancelable:!0}))},u=function(e,t){var n=-1,r=function(e,r,s,a){e.preventDefault(),s?n++:n--,o(r),a.inputField.setAttribute("aria-activedescendant",r[n].id),l(e.srcElement,i(i({event:e},t),{},{selection:t.results[n]}),"navigation")},o=function(t){if(!t)return!1;!function(t){for(var n=0;n<t.length;n++)t[n].removeAttribute("aria-selected"),e.selection.className&&t[n].classList.remove(e.selection.className)}(t),n>=t.length&&(n=0),n<0&&(n=t.length-1),t[n].setAttribute("aria-selected","true"),e.selection.className&&t[n].classList.add(e.selection.className)},a=e.resultsList.navigation||function(t){var i=document.getElementById(e.resultsList.idName);if(!i)return e.inputField.removeEventListener("keydown",a);i=i.getElementsByTagName(e.resultItem.element),27===t.keyCode?(e.inputField.value="",s(e)):40===t.keyCode||9===t.keyCode?r(t,i,!0,e):38===t.keyCode||9===t.keyCode?r(t,i,!1,e):13===t.keyCode&&(t.preventDefault(),n>-1&&i&&i[n].click())};e.inputField.autoCompleteNavigate&&e.inputField.removeEventListener("keydown",e.inputField.autoCompleteNavigate),e.inputField.autoCompleteNavigate=a,e.inputField.addEventListener("keydown",a)},c=function(e,t){for(var n=[],i=function(i){var r=e.data.store[i],s=function(o){var s=(o?r[o]:r).toString();if(s){var a="function"==typeof e.searchEngine?e.searchEngine(t,s):function(e,t,n){var i=n.diacritics?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):t.toLowerCase();if("loose"===n.searchEngine){e=e.replace(/ /g,"");for(var r=[],o=0,s=0;s<i.length;s++){var a=t[s];o<e.length&&i[s]===e[o]&&(a=n.highlight.render?'<span class="'.concat(n.highlight.className,'">').concat(a,"</span>"):a,o++),r.push(a)}if(o===e.length)return r.join("")}else if(i.includes(e)){var l=new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return e=l.exec(t),n.highlight.render?t.replace(e,'<span class="'.concat(n.highlight.className,'">').concat(e,"</span>")):t}}(t,s,e);a&&o?n.push({key:o,index:i,match:a,value:r}):a&&!o&&n.push({index:i,match:a,value:r})}};if(e.data.key){var a,l=o(e.data.key);try{for(l.s();!(a=l.n()).done;)s(a.value)}catch(e){l.e(e)}finally{l.f()}}else s()},r=0;r<e.data.store.length;r++)i(r);return e.sort?n.sort(e.sort):n};return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.name,i=void 0===n?"Search":n,r=e.selector,o=void 0===r?"#autoComplete":r,s=e.observer,a=void 0!==s&&s,l=e.data,u=l.src,c=l.key,d=l.cache,h=void 0!==d&&d,f=l.store,v=l.results,p=e.query,m=e.trigger,g=(m=void 0===m?{}:m).event,y=void 0===g?["input"]:g,b=m.condition,L=void 0!==b&&b,N=e.searchEngine,F=void 0===N?"strict":N,k=e.diacritics,E=void 0!==k&&k,C=e.threshold,w=void 0===C?1:C,A=e.debounce,O=void 0===A?0:A,j=e.resultsList,x=(j=void 0===j?{}:j).render,S=void 0===x||x,I=j.container,P=void 0!==I&&I,T=j.destination,q=j.position,D=void 0===q?"afterend":q,H=j.element,R=void 0===H?"ul":H,_=j.idName,M=void 0===_?"autoComplete_list":_,z=j.className,B=void 0===z?"autoComplete_list":z,$=j.navigation,U=void 0!==$&&$,G=e.sort,J=void 0!==G&&G,K=e.placeHolder,Q=e.maxResults,V=void 0===Q?5:Q,W=e.resultItem,X=(W=void 0===W?{}:W).content,Y=void 0!==X&&X,Z=W.element,ee=void 0===Z?"li":Z,te=W.idName,ne=void 0===te?"autoComplete_result":te,ie=W.className,re=void 0===ie?"autoComplete_result":ie,oe=e.noResults,se=e.selection,ae=(se=void 0===se?{}:se).className,le=void 0===ae?"autoComplete_selected":ae,ue=e.highlight,ce=(ue=void 0===ue?{}:ue).render,de=void 0!==ce&&ce,he=ue.className,fe=void 0===he?"autoComplete_highlighted":he,ve=e.feedback,pe=e.onSelection;this.name=i,this.selector=o,this.observer=a,this.data={src:u,key:c,cache:h,store:f,results:v},this.query=p,this.trigger={event:y,condition:L},this.searchEngine=F,this.diacritics=E,this.threshold=w,this.debounce=O,this.resultsList={render:S,container:P,destination:T||this.selector,position:D,element:R,idName:M,className:B,navigation:U},this.sort=J,this.placeHolder=K,this.maxResults=V,this.resultItem={content:Y,element:ee,idName:ne,className:re},this.noResults=oe,this.selection={className:le},this.highlight={render:de,className:fe},this.feedback=ve,this.onSelection=pe,this.inputField="string"==typeof this.selector?document.querySelector(this.selector):this.selector(),this.observer?this.preInit():this.init()}var n,i,r;return n=t,(i=[{key:"start",value:function(e,t){var n=this,i=this.data.results?this.data.results(c(this,t)):c(this,t),r={input:e,query:t,matches:i,results:i.slice(0,this.maxResults)};return l(this.inputField,r,"results"),i.length?this.resultsList.render?(i.length&&a(this,r,i),l(this.inputField,r,"rendered"),u(this,r),void document.addEventListener("click",(function(e){return s(n,e.target)}))):this.feedback(r):this.noResults?this.noResults(r,a):null}},{key:"dataStore",value:function(){var e=this;return new Promise((function(t,n){return e.data.cache&&e.data.store?t(null):new Promise((function(t,n){return"function"==typeof e.data.src?e.data.src().then(t,n):t(e.data.src)})).then((function(i){try{return e.data.store=i,l(e.inputField,e.data.store,"fetch"),t()}catch(e){return n(e)}}),n)}))}},{key:"compose",value:function(e){var t=this;return new Promise((function(n,i){var r,o,a,l,u;return a=t.inputField,r=a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement?a.value.toLowerCase():a.innerHTML.toLowerCase(),l=r,o=(u=t).query&&u.query.manipulate?u.query.manipulate(l):u.diacritics?l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):l,function(e,t,n){return e.trigger.condition?e.trigger.condition(t,n):n.length>=e.threshold&&n.replace(/ /g,"").length}(t,e,o)?t.dataStore().then((function(e){try{return s(t),t.start(r,o),c.call(t)}catch(e){return i(e)}}),i):(s(t),c.call(t));function c(){return n()}}))}},{key:"init",value:function(){var e,t,n,i,r=this;(e=this).inputField.setAttribute("role","combobox"),e.inputField.setAttribute("aria-haspopup",!0),e.inputField.setAttribute("aria-expanded",!1),e.inputField.setAttribute("aria-controls",e.resultsList.idName),e.inputField.setAttribute("aria-autocomplete","both"),this.placeHolder&&this.inputField.setAttribute("placeholder",this.placeHolder),this.hook=(t=function(e){r.compose(e)},n=this.debounce,function(){var e=this,r=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(e,r)}),n)}),this.trigger.event.forEach((function(e){r.inputField.removeEventListener(e,r.hook),r.inputField.addEventListener(e,r.hook)})),l(this.inputField,null,"init")}},{key:"preInit",value:function(){var e=this;new MutationObserver((function(t,n){var i,r=o(t);try{for(r.s();!(i=r.n()).done;)i.value,e.inputField&&(n.disconnect(),l(e.inputField,null,"connect"),e.init())}catch(e){r.e(e)}finally{r.f()}})).observe(document,{childList:!0,subtree:!0})}},{key:"unInit",value:function(){this.inputField.removeEventListener("input",this.hook),l(this.inputField,null,"unInit")}}])&&e(n.prototype,i),r&&e(n,r),t}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).autoComplete=t();
