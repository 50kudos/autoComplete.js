var e,t;e=this,t=function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}var a=function(e,t,n){e.dispatchEvent(new CustomEvent(n,{bubbles:!0,detail:t,cancelable:!0}))},o=function(e,t){var n=document.getElementById(e.resultsList.idName);n&&t!==e.inputField&&(n.remove(),e.inputField.removeAttribute("aria-activedescendant"),e.inputField.setAttribute("aria-expanded",!1),a(e.inputField,null,"close"))},u="keydown",l="aria-selected",c=function(e,n){e.nav&&e.inputField.removeEventListener(u,e.nav);var i=-1,r=function(r,o,u){r.preventDefault(),o.length&&(u?i++:i--,s(o),e.inputField.setAttribute("aria-activedescendant",o[i].id),a(r.srcElement,t(t({event:r},n),{},{selection:n.results[i]}),"navigate"))},s=function(t){!function(t){for(var n=0;n<t.length;n++)t[n].removeAttribute(l),e.resultItem.selected.className&&t[n].classList.remove(e.resultItem.selected.className)}(t),i>=t.length&&(i=0),i<0&&(i=t.length-1),t[i].setAttribute(l,!0),e.resultItem.selected.className&&t[i].classList.add(e.resultItem.selected.className)};e.nav=function(t){var n=document.getElementById(e.resultsList.idName);if(n)switch(n=n.getElementsByTagName(e.resultItem.element),t.keyCode){case 40:r(t,n,1);break;case 38:r(t,n);break;case 27:e.inputField.value="",o(e);break;case 13:t.preventDefault(),i>=0&&n[i].click();break;case 9:o(e)}},e.inputField.addEventListener(u,e.nav)},d="click",h="aria-expanded",f=function(e,n){n.input;var i=n.query,r=n.matches,s=n.results,u=document.getElementById(e.resultsList.idName);u?(u.innerHTML="",e.inputField.removeAttribute("aria-activedescendant")):u=function(e){var t=document.createElement(e.resultsList.element);return t.setAttribute("id",e.resultsList.idName),t.setAttribute("class",e.resultsList.className),t.setAttribute("role","listbox"),("string"==typeof e.resultsList.destination?document.querySelector(e.resultsList.destination):e.resultsList.destination()).insertAdjacentElement(e.resultsList.position,t),t}(e),e.inputField.setAttribute(h,!0),r.length?(s.forEach((function(i,r){var s=function(e,t,n){var i=document.createElement(n.resultItem.element);return i.setAttribute("id","".concat(n.resultItem.idName,"_").concat(t)),i.setAttribute("class",n.resultItem.className),i.setAttribute("role","option"),i.innerHTML=e.match,n.resultItem.content&&n.resultItem.content(e,i),i}(i,r,e);s.addEventListener(d,(function(s){var a=t(t({event:s},n),{},{selection:t(t({},i),{},{index:r})});e.onSelection&&e.onSelection(a)})),u.appendChild(s)})),a(e.inputField,n,"open")):e.resultsList.noResults?e.resultsList.noResults(u,i):(o(e),e.inputField.setAttribute(h,!1)),e.resultsList.container&&e.resultsList.container(u,n),e.resultsList.navigation?e.resultsList.navigation(u):c(e,n),document.addEventListener(d,(function(t){return o(e,t.target)}))},m=function(e,t){return'<span class="'.concat(e,'">').concat(t,"</span>")},p=function(e,t){var n=e.data,i=e.searchEngine,r=[];return n.store.forEach((function(a,o){var u=function(n){var s=(n?a[n]:a).toString();if(s){var u="function"==typeof i?i(t,s):function(e,t,n){var i=n.diacritics?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):t.toLowerCase();if("loose"===n.searchEngine){e=e.replace(/ /g,"");for(var r=[],s=0,a=0;a<i.length;a++){var o=t[a];s<e.length&&i[a]===e[s]&&(o=n.resultItem.highlight.render?m(n.resultItem.highlight.className,o):o,s++),r.push(o)}if(s===e.length)return r.join("")}else if(i.includes(e)){var u=new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return e=u.exec(t),n.resultItem.highlight.render?t.replace(e,m(n.resultItem.highlight.className,e)):t}}(t,s,e);u&&n?r.push({key:n,index:o,match:u,value:a}):u&&!n&&r.push({index:o,match:u,value:a})}};if(n.key){var l,c=s(n.key);try{for(c.s();!(l=c.n()).done;)u(l.value)}catch(e){c.e(e)}finally{c.f()}}else u()})),r};return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.selector,i=void 0===n?"#autoComplete":n,r=t.placeHolder,s=t.observer,a=t.data,o=a.src,u=a.key,l=a.cache,c=a.store,d=a.results,h=t.query,f=t.trigger,m=(f=void 0===f?{}:f).event,p=void 0===m?["input"]:m,v=f.condition,b=t.threshold,g=void 0===b?1:b,y=t.debounce,L=void 0===y?0:y,E=t.diacritics,F=t.searchEngine,N=t.feedback,A=t.resultsList,k=(A=void 0===A?{}:A).render,w=void 0===k||k,I=A.container,O=A.destination,j=void 0===O?i:O,x=A.position,C=void 0===x?"afterend":x,S=A.element,P=void 0===S?"ul":S,T=A.idName,q=void 0===T?"autoComplete_list":T,H=A.className,D=A.maxResults,R=void 0===D?5:D,M=A.navigation,_=A.noResults,z=t.resultItem,B=(z=void 0===z?{}:z).content,$=z.element,U=void 0===$?"li":$,G=z.idName,J=z.className,K=void 0===J?"autoComplete_result":J,Q=z.highlight,V=(Q=void 0===Q?{}:Q).render,W=Q.className,X=void 0===W?"autoComplete_highlighted":W,Y=z.selected,Z=(Y=void 0===Y?{}:Y).className,ee=void 0===Z?"autoComplete_selected":Z,te=t.onSelection;this.selector=i,this.observer=s,this.placeHolder=r,this.data={src:o,key:u,cache:l,store:c,results:d},this.query=h,this.trigger={event:p,condition:v},this.threshold=g,this.debounce=L,this.diacritics=E,this.searchEngine=F,this.feedback=N,this.resultsList={render:w,container:I,destination:j,position:C,element:P,idName:q,className:H,maxResults:R,navigation:M,noResults:_},this.resultItem={content:B,element:U,idName:G,className:K,highlight:{render:V,className:X},selected:{className:ee}},this.onSelection=te,this.inputField="string"==typeof this.selector?document.querySelector(this.selector):this.selector(),this.observer?this.preInit():this.init()}var t,i,r;return t=e,(i=[{key:"start",value:function(e,t){var n=this.data.results?this.data.results(p(this,t)):p(this,t),i={input:e,query:t,matches:n,results:n.slice(0,this.resultsList.maxResults)};if(a(this.inputField,i,"results"),!this.resultsList.render)return this.feedback(i);f(this,i)}},{key:"dataStore",value:function(){var e=this;return new Promise((function(t,n){return e.data.cache&&e.data.store?t(null):new Promise((function(t,n){return"function"==typeof e.data.src?e.data.src().then(t,n):t(e.data.src)})).then((function(i){try{return e.data.store=i,a(e.inputField,e.data.store,"fetch"),t()}catch(e){return n(e)}}),n)}))}},{key:"compose",value:function(e){var t=this;return new Promise((function(n,i){var r,s,a,u,l;return a=t.inputField,r=a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement?a.value.toLowerCase():a.innerHTML.toLowerCase(),u=r,s=(l=t).query&&l.query.manipulate?l.query.manipulate(u):l.diacritics?u.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):u,function(e,t,n){return e.trigger.condition?e.trigger.condition(t,n):n.length>=e.threshold&&n.replace(/ /g,"").length}(t,e,s)?t.dataStore().then((function(e){try{return t.start(r,s),c.call(t)}catch(e){return i(e)}}),i):(o(t),c.call(t));function c(){return n()}}))}},{key:"init",value:function(){var e,t,n,i,r=this;(e=this).inputField.setAttribute("role","combobox"),e.inputField.setAttribute("aria-haspopup",!0),e.inputField.setAttribute("aria-expanded",!1),e.inputField.setAttribute("aria-controls",e.resultsList.idName),e.inputField.setAttribute("aria-autocomplete","both"),this.placeHolder&&this.inputField.setAttribute("placeholder",this.placeHolder),this.hook=(t=function(e){r.compose(e)},n=this.debounce,function(){var e=this,r=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(e,r)}),n)}),this.trigger.event.forEach((function(e){r.inputField.addEventListener(e,r.hook)})),a(this.inputField,null,"init")}},{key:"preInit",value:function(){var e=this;new MutationObserver((function(t,n){t.forEach((function(t){e.inputField&&(n.disconnect(),e.init())}))})).observe(document,{childList:!0,subtree:!0})}},{key:"unInit",value:function(){var e=this;this.trigger.event.forEach((function(t){e.inputField.removeEventListener(t,e.hook)})),a(this.inputField,null,"unInit")}}])&&n(t.prototype,i),r&&n(t,r),e}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).autoComplete=t();
