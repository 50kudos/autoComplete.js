var a,b;a=this,b=function(){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function u(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,e=function(){};return{s:e,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function c(t,e){for(var i=document.getElementsByClassName("autoComplete_list"),n=0;n<i.length;n++)t!==i[n]&&t!==e&&i[n].parentNode.removeChild(i[n])}function s(a,l,u){for(var t,e,i,c=(t=l.inputField,e=l,(i=document.createElement("div")).setAttribute("id",e.listId),i.setAttribute("aria-expanded",!0),i.setAttribute("aria-labelledby",e.listId),i.setAttribute("class",e.listClass),i.setAttribute("role","listbox"),i.setAttribute("tabindex","-1"),e.container&&container(i),t.parentNode.appendChild(i),i),n=function(e){var t,i,n,r,s,o=a[e].match,o=(t=o,i=a[e].value,n=e,r=l.itemClass,s=l.itemContent,(o=document.createElement("div")).setAttribute("id","".concat(r,"_").concat(n)),o.setAttribute("aria-selected","false"),o.setAttribute("class",r),o.setAttribute("role","option"),o.innerHTML=t,s&&s(i,o),o);o.addEventListener("click",function(){var t={input:l.rawInputValue,query:l.queryInputValue,results:a,selection:a[e].value};u(t)}),c.appendChild(o)},r=0;r<a.length;r++)n(r);return c}function d(t,e,i){t.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:e,cancelable:!0}))}function i(t){t&&(function(t){for(var e=0;e<t.length;e++)t[e].setAttribute("aria-selected","false"),t[e].classList.remove("autoComplete_selected")}(t),h>=t.length&&(h=0),h<0&&(h=t.length-1),t[h].setAttribute("aria-selected","true"),t[h].classList.add("autoComplete_selected"))}function o(t){var e;t.target.value.trim()&&(e=(e=document.getElementById("autoComplete_list"))&&e.getElementsByTagName("div"),27===t.keyCode?c(!1,t.target):40===t.keyCode||9===t.keyCode?(t.preventDefault(),h++,i(e)):38===t.keyCode||9===t.keyCode?(t.preventDefault(),h--,i(e)):13===t.keyCode&&(t.preventDefault(),-1<h&&e&&e[h].click()),d(t.srcElement,{selection:e[h],event:t},"navigation"))}function l(s,o,a){for(var l=[],t=function(i){function t(t){var e=t?n[t]:n;e&&((e="function"==typeof a.searchEngine?a.searchEngine(s,e):function(t,e,i){var n=e.toLowerCase();if("loose"===i.searchEngine){t=t.replace(/ /g,"");for(var r=[],s=0,o=0;o<n.length;o++){var a=e[o];s<t.length&&n[o]===t[s]&&(a=i.highlight?'<span class="autoComplete_highlighted">'.concat(a,"</span>"):a,s++),r.push(a)}if(s===t.length)return r.join("")}else if(n.includes(t))return t=new RegExp("".concat(t),"i").exec(e),i.highlight?e.replace(t,'<span class="autoComplete_highlighted">'.concat(t,"</span>")):e}(s,e,a))&&t?l.push({key:t,index:i,match:e,value:n}):e&&!t&&l.push({index:i,match:e,value:n}))}var n=o[i];if(a.key){var e,r=u(a.key);try{for(r.s();!(e=r.n()).done;)t(e.value)}catch(t){r.e(t)}finally{r.f()}}else t()},e=0;e<o.length;e++)t(e);return(a.sort?l.sort(a.sort):l).slice(0,a.maxResults)}var h;return function(){function S(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,S);var e=t.name,i=void 0===e?"Search":e,n=t.selector,r=void 0===n?"#autoComplete":n,s=t.data,o=s.src,a=s.key,l=s.cache,u=void 0===l||l,c=t.query,d=t.trigger,h=(d=void 0===d?{}:d).event,p=void 0===h?["input"]:h,f=d.condition,m=void 0!==f&&f,v=t.searchEngine,b=void 0===v?"strict":v,y=t.threshold,g=void 0===y?0:y,C=t.debounce,A=void 0===C?0:C,k=t.resultsList,I=(k=void 0===k?{}:k).render,E=void 0===I||I,L=k.container,N=void 0!==L&&L,F=k.destination,w=k.position,x=void 0===w?"afterend":w,e=k.element,n=void 0===e?"ul":e,s=k.idName,l=void 0===s?"autoComplete_list":s,h=k.className,d=void 0===h?"autoComplete_list":h,f=k.navigation,v=void 0!==f&&f,y=t.sort,C=void 0!==y&&y,I=t.placeHolder,L=t.maxResults,w=void 0===L?5:L,e=t.resultItem,s=(e=void 0===e?{}:e).content,h=void 0!==s&&s,k=e.element,f=void 0===k?"li":k,y=e.idName,L=void 0===y?"autoComplete_result":y,s=e.className,k=void 0===s?"autoComplete_result":s,y=t.noResults,e=t.highlight,s=void 0!==e&&e,e=t.feedback,t=t.onSelection;this.name=i,this.selector=r,this.data={src:function(){return"function"==typeof o?o():o},key:a,cache:u},this.query=c,this.trigger={event:p,condition:m},this.searchEngine=b,this.threshold=g,this.debounce=A,this.resultsList={render:E,container:N,destination:F||this.inputField,position:x,element:n,idName:l,className:d,navigation:v},this.sort=C,this.placeHolder=I,this.maxResults=w,this.resultItem={content:h,element:f,idName:L,className:k},this.noResults=y,this.highlight=s,this.feedback=e,this.onSelection=t,this.preInit()}var t,e,i;return t=S,(e=[{key:"start",value:function(t,e,i){var n=this,r=l(i,t,{searchEngine:this.searchEngine,highlight:this.highlight,key:this.data.key,sort:this.sort,maxResults:this.maxResults});if(d(this.inputField,{input:e,query:i,results:r},"response"),!t.length)return this.noResults();t={input:e,query:i,results:r};if(!this.resultsList.render)return this.feedback(t);r.length&&s(r,{inputField:this.inputField,rawInputValue:e,queryInputValue:i,listId:this.resultsList.idName,listClass:this.resultsList.className,itemId:this.resultItem.idName,itemClass:this.resultItem.className,listContainer:this.resultsList.container,itemContent:this.resultItem.content},this.onSelection);d(this.inputField,{input:e,query:i,results:r},"rendered"),function(t,e){h=-1;var i=e||o;t.addEventListener("keydown",i)}(this.inputField,this.resultsList.navigation),document.addEventListener("click",function(t){return c(t.target,n.inputField)})}},{key:"compose",value:function(){var u=this;return new Promise(function(r,s){var o,a,l;return u.data.src().then(function(t){try{return o=t,d(u.inputField,o,"request"),n=u.inputField,a=(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n.value:n.innerHTML).toLowerCase(),e=a,i=u.query,l=i&&i.manipulate?i.manipulate(e):e,c(!1,u.inputField),n=u.trigger,i=l,e=u.threshold,(n.condition?n.condition(i):i.length>=e&&i.replace(/ /g,"").length)&&u.start(o,a,l),r()}catch(t){return s(t)}var e,i,n},s)})}},{key:"init",value:function(){var i,n,r,e=this;this.placeHolder&&this.inputField.setAttribute("placeholder",this.placeHolder),this.hook=(i=function(t){e.compose(t)},n=this.debounce,function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout(function(){return i.apply(t,e)},n)}),this.inputField.addEventListener("input",this.hook),d(this.inputField,null,"init")}},{key:"preInit",value:function(){var o=this,a=document;new MutationObserver(function(t,e){var i,n,r=u(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;a.querySelector(o.selector)&&(e.disconnect(),o.inputField=a.querySelector(o.selector),i=o.inputField,n={inputName:o.name,listId:o.resultsList.idName,listClass:o.resultsList.className,itemId:o.resultItem.idName,itemClass:o.resultItem.className},i.setAttribute("dir","ltr"),i.setAttribute("type","text"),i.setAttribute("spellcheck",!1),i.setAttribute("autocorrect","off"),i.setAttribute("autocomplete","off"),i.setAttribute("autocapitalize","off"),i.setAttribute("title",n.inputName),i.setAttribute("role","combobox"),i.setAttribute("aria-label",n.inputName),i.setAttribute("aria-owns",n.listId),i.setAttribute("aria-haspopup",!0),i.setAttribute("aria-autocomplete","both"),d(o.inputField,{mutation:s},"connect"),o.init())}}catch(t){r.e(t)}finally{r.f()}}).observe(a,{childList:!0,subtree:!0})}},{key:"unInit",value:function(){this.inputField.removeEventListener("input",this.hook),d(this.inputField,null,"unInit")}}])&&n(t.prototype,e),i&&n(t,i),S}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"!=typeof globalThis?globalThis:a||self).autoCompleteJS=b();
