var a,b;a=this,b=function(){"use strict";function n(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o="data-result",l={resultsList:"autoComplete_results_list",result:"autoComplete_result",highlight:"autoComplete_highlighted"},u=function(t){return"string"==typeof t?document.querySelector(t):t()},c=function(t){return t.innerHTML=""},h=u,r=function(t){var e=document.createElement("ul");return t.container&&(l.resultsList=t.container(e)||l.resultsList),e.setAttribute("id",l.resultsList),t.destination.insertAdjacentElement(t.position,e),e},d=function(t){return"<span class=".concat(l.highlight,">").concat(t,"</span>")},a=function(n,r,t,a){r.forEach(function(t,e){var s=document.createElement("li"),i=r[e].value[t.key]||r[e].value;s.setAttribute(o,i),s.setAttribute("class",l.result),s.setAttribute("tabindex","1"),s.innerHTML=a?a(t,s):t.match||t,n.appendChild(s)})},f=function(t,s){var i=u(t),n=s.firstChild;document.onkeydown=function(t){var e=document.activeElement;switch(t.keyCode){case 38:e!==n&&e!==i?e.previousSibling.focus():e===n&&i.focus();break;case 40:e===i&&0<s.childNodes.length?n.focus():e!==s.lastChild&&e.nextSibling.focus()}}},v=c,m=function(s,i,n,r){var a=i.querySelectorAll(".".concat(l.result));Object.keys(a).forEach(function(e){["mousedown","keydown"].forEach(function(t){a[e].addEventListener(t,function(e){"mousedown"!==t&&13!==e.keyCode&&39!==e.keyCode||(n({event:e,query:u(s).value,matches:r.matches,results:r.list.map(function(t){return t.value}),selection:r.list.find(function(t){return(t.value[t.key]||t.value)===e.target.closest(".".concat(l.result)).getAttribute(o)})}),c(i))})})})};return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector||"#autoComplete",this.data={src:function(){return"function"==typeof t.data.src?t.data.src():t.data.src},key:t.data.key},this.searchEngine="loose"===t.searchEngine?"loose":"strict",this.threshold=t.threshold||0,this.resultsList=r({container:!(!t.resultsList||!t.resultsList.container)&&t.resultsList.container,destination:t.resultsList&&t.resultsList.destination?t.resultsList.destination:h(this.selector),position:t.resultsList&&t.resultsList.position?t.resultsList.position:"afterend"}),this.sort=t.sort||!1,this.placeHolder=t.placeHolder,this.maxResults=t.maxResults||5,this.resultItem=t.resultItem,this.highlight=t.highlight||!1,this.onSelection=t.onSelection,this.shouldCacheSrc=void 0===t.shouldCacheSrc||t.shouldCacheSrc,this.dataSrc,this.init()}var t,s,i;return t=e,(s=[{key:"search",value:function(t,e){var s=this.highlight,i=e.toLowerCase();if("loose"===this.searchEngine){t=t.replace(/ /g,"");for(var n=[],r=0,a=0;a<i.length;a++){var o=e[a];r<t.length&&i[a]===t[r]&&(o=s?d(o):o,r++),n.push(o)}return r===t.length&&n.join("")}if(i.includes(t))return t=new RegExp("".concat(t),"i").exec(e),s?e.replace(t,d(t)):e}},{key:"listMatchedResults",value:function(t){var l=this,u=[],c=h(this.selector).value.toLowerCase();t.filter(function(s,i){var t=function(t){var e=l.search(c,s[t]||s);e&&t?u.push({key:t,index:i,match:e,value:s}):e&&!t&&u.push({index:i,match:e,value:s})};if(l.data.key){var e=!0,n=!1,r=void 0;try{for(var a,o=l.data.key[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){t(a.value)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}else t()});var e=this.sort?u.sort(this.sort).slice(0,this.maxResults):u.slice(0,this.maxResults);return a(this.resultsList,e,this.data.key,this.resultItem),f(this.selector,this.resultsList),{matches:u.length,list:e}}},{key:"ignite",value:function(){var n=this,r=this.selector,a=h(r),t=this.placeHolder,o=this.onSelection;t&&a.setAttribute("placeholder",t),a.onkeyup=function(t){if(!n.shouldCacheSrc){var e=n.data.src();e instanceof Promise?e.then(function(t){n.dataSrc=t}):n.dataSrc=e}var s=n.resultsList;v(s);if(a.value.length>n.threshold&&a.value.replace(/ /g,"").length){var i=n.listMatchedResults(n.dataSrc);a.dispatchEvent(new CustomEvent("type",{bubbles:!0,detail:{event:t,query:a.value,matches:i.matches,results:i.list},cancelable:!0})),o&&m(r,s,o,i)}}}},{key:"init",value:function(){var e=this,t=this.data.src();t instanceof Promise?t.then(function(t){e.dataSrc=t,e.ignite()}):(this.dataSrc=t,this.ignite())}}])&&n(t.prototype,s),i&&n(t,i),e}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
